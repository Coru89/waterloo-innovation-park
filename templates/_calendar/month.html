{% extends "_calendar/layouts/_layout.twig" %}

{% set pageTitle = "Month" %}
{% set page = "month" %}

{% block content %}

<div class="u-container">

    <h1>Month View</h1>
    <p class="lead">Below is full month calendar view, which allows you to see all your event occurrences.</p>
    <hr /><br />

    {% set targetDate = "today" %}
    {% set calendarHandle = null %}

    {% if segment3 == "calendar" %}
        {% set calendarHandle = segment4 %}
        {% if segment5 %}
            {% set targetDate = segment5~"-"~segment6~"-01" %}
        {% endif %}
    {% elseif segment3 is not empty %}
        {% set targetDate = segment3~"-"~segment4~"-01" %}
    {% endif %}

    <div class="row">
        <div class="col-md-9">

            {% include "_calendar/layouts/_calendar_banner.html" %}

            <div id="month_calendar">
                {% set month = craft.calendar.month({
                    date: "today",
                    calendar: segment4,
                }) %}

                {% set dateBoundsHelper = now.diff(month.nextDate)|date('%r%a') %}

                <div class="row justify-content-between mb-3">
                    <div class="col-3">
                    {% if dateBoundsHelper > -365 %}
                        <a class="btn btn-outline-secondary"
                           href="{{ siteUrl }}the-link/calendar/{{ segment3 == "calendar" ? "calendar/"~segment4~"/" }}{{ month.previousDate.format('Y/m') }}">
                            <span class="fas fa-arrow-left"></span> {{ month.previousDate.format('F') }}
                        </a>
                    {% endif %}
                    </div>

                    <div class="col-auto">
                        <h3>
                            {% include "_calendar/layouts/_month_heading.html" with {month: month} only %} &nbsp;
                            <span class="badge {{ month.eventCount ? "badge-warning" : "badge-secondary" }}">
                                {{ month.eventCount }} event{{ month.eventCount > 1 or month.eventCount == 0 ? "s" }}
                            </span>
                        </h3>
                    </div>

                    <div class="col-3 clearfix">
                    {% if dateBoundsHelper < 365 %}
                        <a class="btn btn-outline-secondary float-right"
                           href="{{ siteUrl }}the-link/calendar/{{ segment3 == "calendar" ? "calendar/"~segment4~"/" }}{{ month.nextDate.format('Y/m') }}">
                            {{ month.nextDate.format('F') }} <span class="fas fa-arrow-right"></span>
                        </a>
                    {% endif %}
                    </div>

                    <div class="button-group">
                        <a href="" class="btn btn-outline-secondary active">month</a>
                        <a href="{{ siteUrl }}the-link/calendar/week/{{ segment2 == "calendar"  ? ""~segment3~"/"~segment4~"/01" }}" class="btn btn-outline-secondary">week</a>
                        <!-- <a type="button" class="btn">day</a> -->
                    </div>
                </div>

                <table id="month_calendar_inner" class="table table-bordered">
                    <thead>
                    <tr id="days_of_week" class="active">
                        {% for day in month|first %}
                            <th class="day_of_week">
                                {{ day.date.format('l') }}
                            </th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    {% for week in month %}
                        <tr>
                            {% for day in week %}
                                {% if month.containsDate(day.date) %}
                                <td class="day_cell{{ day.dateLocalized.isToday ? " today" }}">
                                    <div class="date{{ day.eventCount ? " has_events" }}">
                                        <a class="num"
                                           href="{{ siteUrl }}the-link/calendar/{{ segment3 == 'calendar' ? "calendar/"~segment4~"/" }}{{ day.date.format('Y/m/d') }}">
                                            {{ day.date.format('j') }}
                                        </a>
                                    </div>
                                {% else %}
                                    <td class="day_cell out_of_range">
                                    <div class="date">
                                        <span class="num">
                                            {{ day.date.format('j') }}
                                        </span>
                                    </div>
                                {% endif %}

                                {% for event in day.events %}
                                    {% include "_calendar/layouts/_event.html" %}
                                {% endfor %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>

        <div class="col-md-3">
            {% include "_calendar/layouts/_sidebar.html" %}
        </div>
    </div>

    <div class="row">
        {% macro pager(pageInfo) %}
    {% if pageInfo.total > 1 %}
        <ul class="pagination">
            {% if pageInfo.prevUrl %}
                <li class="page-item">
                    <a class="page-link" href="{{ pageInfo.prevUrl }}">&laquo; Previous</a>
                </li>
            {% endif %}

            {% for page, url in pageInfo.getPrevUrls(3) %}
                <li class="page-item">
                    <a class="page-link" href="{{ url }}">{{ page }}</a>
                </li>
            {% endfor %}


            <li class="page-item active">
                <a class="page-link" href="#">{{ pageInfo.currentPage }}</a>
            </li>

            {% for page, url in pageInfo.getNextUrls(3) %}
                <li class="page-item">
                    <a class="page-link" href="{{ url }}">{{ page }}</a>
                </li>
            {% endfor %}

            {% if pageInfo.nextUrl %}
                <li class="page-item">
                    <a class="page-link" href="{{ pageInfo.nextUrl }}">Next &raquo;</a>
                </li>
            {% endif %}
        </ul>
    {% endif %}
{% endmacro %}
{% from _self import pager %}



{% if segment3 and segment4 and segment5 %}
    {% set targetStartDate = segment3 ~ '-' ~ segment4 ~ '-01' %}
    {% set targetEndDate = segment3 ~ '-' ~ segment4 ~ '-' ~ segment5 %}
{% else %}
    {% set targetStartDate = 'today' %}
    {% set targetEndDate = '+30 days' %}
{% endif %}

    <h1>Upcoming Events</h1>
    <p class="lead">
        Below is list of events happening soon.
    </p>
    <hr /><br />

    <div class="row">
        <div class="col-md-9">
            {% set eventOptions = {
                rangeStart: targetStartDate,
                rangeEnd: targetEndDate,
                limit: 5
            } %}

            {% paginate craft.calendar.events(eventOptions) as pageInfo, events %}

            {% for event in events %}

                <div class="card" style="border-color: {{ event.calendar.color }}; margin-bottom: 20px;">
                    <h4 class="card-header d-flex justify-content-between align-items-center" style="color: {{ event.calendar.contrastColor }}; background-color: {{ event.calendar.lighterColor }};">
                        {{ event.title }}&nbsp;&nbsp;
                        <a href="{{ siteUrl }}the-link/calendar/event/{{ event.id }}/{{ event.repeating ? event.startDate.format('Y/m/d') }}" class="btn btn-light btn-sm border-light border border-dark">View Event</a>
                    </h4>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <strong>
                            {{ event.startDate.format('l, F j, Y') }}
                            {% if event.allDay %}
                                (all day)
                            {% else %}
                                at {{ event.startDate.format("g:ia") }} -
                                {% if event.multiDay %}
                                    <br />{{ event.endDate.format("l, F j, Y \\a\\t g:ia") }}
                                {% else %}
                                    {{ event.endDate.format("g:ia") }}
                                {% endif %}
                            {% endif %}
                        </strong>
                        </li>
                        <li class="list-group-item">
                            Calendar:&nbsp;
                            <strong style="color: {{ event.calendar.color }};"><span class="fas fa-calendar-alt" aria-hidden="true"></span>&nbsp;{{ event.calendar.name }}</strong>
                        </li>
                        <li class="list-group-item">
                            Location:&nbsp;
                            {% if event['location'] is defined and event.location is not empty %}
                                {{ event.location|striptags }}
                            {% else %}
                                N/A
                            {% endif %}
                        </li>
                        <li class="list-group-item">
                            Description:&nbsp;
                            {% if event['description'] is defined and event.description is not empty %}
                                {{ event.description|striptags }}
                            {% else %}
                                N/A
                            {% endif %}
                        </li>
                    </ul>
                </div>

            {% else %}
                <p>No events could be found within the specified time range (today until 6 months from today).</p>
            {% endfor %}

            <!-- {{ pager(pageInfo) }} -->
        </div>

    </div>



    </div>

    

</div>

<script>

window.addEventListener('beforeunload', function() {
  sessionStorage.setItem('scrollPosition', window.pageYOffset || document.documentElement.scrollTop);
});
window.addEventListener('load', function() {
  var storedPosition = sessionStorage.getItem('scrollPosition');
  if (storedPosition) {
    window.scrollTo(0, storedPosition);
    sessionStorage.removeItem('scrollPosition');
  }
});

    </script>
{% endblock %}

