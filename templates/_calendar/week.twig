{% extends "_calendar/layouts/_layout.twig" %}

{% set pageTitle = "Week" %}
{% set page = "week" %}

{% block content %}

	<div class="u-container">
		<h1>Week View</h1>
		<p class="lead">
			Below is full week calendar view, which allows you to see all your event occurrences in a daily view.
		</p>
		<hr/><br/>

        <div class="button-group">
            <a href="{{ siteUrl }}the-link/calendar{{ segment4 ? "/"~segment4~"/"~segment5~"/" }}" class="btn btn-outline-secondary">month</a>
            <a href="#" class="btn btn-outline-secondary active">week</a>
            <a href="{{ siteUrl }}the-link/calendar/week" class="btn btn-outline-secondary">Today</a>
            <!-- <a type="button" class="btn">day</a> -->
        </div>

		{% set calendarHandle = "calendar" %}
		{% set targetDate = segment4~"-"~segment5~"-"~segment6 %}

		<div class="row">
			<div class="col-md-9">

				{% include "_calendar/layouts/_calendar_banner.html" %}

				<div id="week_calendar">
					{% if segment5 %}


						{% set week = craft.calendar.week({
                            date: targetDate,
                            calendar: calendarHandle,
                        }) %}

					{% else %}
						{% set week = craft.calendar.week({
                            date: "today",
                            calendar: calendarHandle,
                        }) %}
					{% endif %}


					{% set dateBoundsHelper = now.diff(week.nextDate)|date('%r%a') %}

					<div class="row justify-content-between mb-3">
						<div class="col-2">
							{% if dateBoundsHelper > -365 %}
								<a class="btn btn-outline-secondary" href="{{ siteUrl }}the-link/calendar/week/{{ segment3 == "calendar" ? "calendar/"~segment4~"/" }}{{ week.previousDate.format('Y/m/d') }}">
									<span class="fas fa-arrow-left"></span>
									Last Week
								</a>
							{% endif %}
						</div>

						<div class="col-auto">
							<h3>
								Week of
								{{ week.date.format("F j, Y") }}
								&nbsp;
								<span class="badge {{ week.eventCount ? " badge-warning" : " badge-secondary" }}">
									{{ week.eventCount }}
									event{{ week.eventCount > 1 or week.eventCount == 0 ? "s" }}
								</span>
							</h3>
						</div>

						<div class="col-2 clearfix">
							{% if dateBoundsHelper < 365 %}
								<a class="btn btn-outline-secondary float-right" href="{{ siteUrl }}the-link/calendar/week/{{ segment3 == "calendar" ? "calendar/"~segment4~"/" }}{{ week.nextDate.format('Y/m/d') }}">
									Next Week
									<span class="fas fa-arrow-right"></span>
								</a>
							{% endif %}
						</div>
					</div>

					{% for day in week %}
						<ul class="list-group mb-4">
							<li class="list-group-item list-group-item-{{ day.dateLocalized.isToday ? " warning" : " secondary" }}">
								<a class="text-dark font-weight-bold" href="{{ siteUrl }}the-link/calendar/{{ segment3 == "calendar" ? segment3~"/"~segment4~"/" }}{{ day.date.format('Y/m/d') }}">
									{% if day.dateLocalized.isToday %}
										TODAY
									{% else %}
										{{ day.date.format('l, F j, Y') }}
									{% endif %}
								</a>
								&nbsp;
								{% if day.eventCount %}
									<span class="badge badge-warning">
										{{ day.eventCount }}
										event{{ day.eventCount > 1 ? "s" }}
									</span>
								{% endif %}
							</li>
							<li class="list-group-item">
								{% if day.events %}
									<ul class="list-group">
										{% for event in day.events %}
											<li class="list-group-item d-flex align-items-center justify-content-between" style="border-left: 5px solid {{ event.calendar.color }};">
												<div>
													<span class="far fa-clock"></span>
													{% if event.allDay %}
														All Day
													{% else %}
														{% if event.multiDay %}
															{% if day.containsDate(event.startDate) %}
																Starts
																{{ event.startDate.format("g:ia") }}
															{% elseif day.containsDate(event.endDate) %}
																Ends
																{{ event.endDate.format("g:ia") }}
															{% else %}
																All Day
															{% endif %}
														{% else %}
															{{ event.startDate.format("g:ia") }}
															-
															{{ event.endDate.format("g:ia") }}
														{% endif %}
													{% endif %}
													<b>
														<a href="{{ siteUrl }}the-link/calendar/event/{{ event.id }}/{{ event.repeating ? event.startDate.format("Y/m/d") }}" class="calendar_event_title">
															{{ event.title }}</a>
													</b>
													{% if event['location'] is defined %}
														&nbsp;&nbsp;<i>{{ event.location }}</i>
													{% endif %}
												</div>

												<a href="{{ siteUrl }}the-link/calendar/{{ event.calendar.handle }}" class="badge" style="background-color: {{ event.calendar.color }}; color: {{ event.calendar.contrastColor }};">
													{{ event.calendar.name }}
												</a>
											</li>
										{% endfor %}
									</ul>
								{% else %}
									No events for this day.
								{% endif %}
							</li>
						</ul>
					{% endfor %}
				</div>
			</div>

			<div class="col-md-3">
				{% include "_calendar/layouts/_sidebar.html" %}
			</div>

		</div>
	</div>


{% endblock %}
