{% set theLayout = craft.app.request.isAjax and not craft.app.request.isLivePreview ? '_ajaxLayout' : '_layout' %}
{% set theLayout = craft.app.request.isAjax and not craft.app.request.isLivePreview ? '_ajaxLayout' : 'base' %}
{% extends theLayout %}

{# {% set entries = craft.entries.section('news').limit(12) %} #}
{% set entries = craft.entries.section('exhibitions').one().galleryItems.limit(2) %}

{% block content %}   

{# {{ dump(entries) }} #}

<script>console.log({{ entries | json_encode | raw }});</script>

{% paginate entries as pageInfo, pageEntries %}

<script>console.log({{ pageInfo | json_encode | raw }});</script>
<script>console.log({{ pageEntries | json_encode |raw }});</script>

{# =============================================================================== #}

  
    {# <h1>News</h1>
    <p>Introduction</p> #}
    <ul class="js-ajaxPagination">      
        {% for card in pageEntries %}
            <li>{{card.artName}}</li>
            {# <li>{% include '_partials/card'  %}</li> #}
        {% endfor %}
    </ul>
    {# allow no-js/googlebot fallback with a regular href to the next page... #}
    <p><a class="js-loadMore" href="{{ '/' ~ craft.app.request.pathInfo ~ '/p' ~ (pageInfo.currentPage + 1) }}">Load more</a></p>
{% endblock %}

{# =============================================================================== #}

{% block ajaxContent %}
    {% for card in pageEntries %}
        <li>{{card.artName}}</li>
        {# <li>{% include '_partials/card' %}</li> #}
    {% endfor %}
{% endblock %}

{% if pageInfo is defined and pageInfo.total > 12 %}

{% js %}
		var currentPage = 1;
		var perPage = 2;
		var count = perPage;

		document.querySelector('.js-loadMore').addEventListener('click', e => {
			e.preventDefault();
			e.currentTarget.classList.add('disabled', 'pointer-events-none');
			var originalWidth = e.currentTarget.offsetWidth;
			var buttonText = document.querySelector('.js-loadMore').textContent;
			e.currentTarget.style.width = originalWidth;
			e.currentTarget.textContent = 'Loading...';
			if({{ pageInfo.total }} > count){
				fetch(e.currentTarget.getAttribute('href'), {
					headers: {
						'X-Requested-With': 'XMLHttpRequest',
					},
					method: 'GET'
				}).then(response => response.text()).then(data => {

					document.querySelector('.js-ajaxPagination').insertAdjacentHTML('beforeend', data);
					var button = document.querySelector('.js-loadMore');
					button.textContent = buttonText;
					// increment the counters
					count = count + perPage;
					currentPage++;
					button.style.display = 'block';
					button.href = '/{{ craft.app.request.pathInfo }}/p' + (currentPage + 1);
					button.classList.remove('disabled', 'pointer-events-none');
					if({{ pageInfo.total }} <= count){
						button.remove();
					}
				});
			}
		});
	{% endjs %}
    {% endif %}